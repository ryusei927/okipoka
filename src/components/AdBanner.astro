---
// src/components/AdBanner.astro
import adsData from '../data/ads.json';

// 型定義
interface Ad {
  id: string;
  name: string;
  url: string;
  images: {
    square: string;
    banner: string;
  };
}

// ★★★ バナー画像を持つ広告のみを抽出 ★★★
const bannerAds = adsData.filter((ad: Ad) => ad.images.banner && ad.images.banner.trim() !== '');

function shuffleArray(array: Ad[]): Ad[] {
  let currentIndex = array.length, randomIndex;
  while (currentIndex !== 0) {
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--;
    [array[currentIndex], array[randomIndex]] = [
      array[randomIndex], array[currentIndex]];
  }
  return array;
}

// バナー広告の中から1つだけランダムで選ぶ
const shuffledAds = shuffleArray(bannerAds);
const selectedAd = shuffledAds.length > 0 ? shuffledAds[0] : null;
---

{/* 広告が1つでも存在する場合のみ表示する */}
{selectedAd && (
  <section class="ad-section">
    <div class="ad-container-wrapper" role="region" aria-labelledby="ad-banner-label">
      <div id="ad-banner-label" class="ad-label">広告</div>
      <div class="ad-container">
        <a href={selectedAd.url} target="_blank" rel="noopener noreferrer" class="ad-item">
          <img src={selectedAd.images.banner} alt={selectedAd.name} loading="lazy" />
        </a>
      </div>
    </div>
  </section>
)}

<style>
  .ad-section { margin: 3.2rem 0; }
  .ad-container-wrapper { position: relative; padding-top: 1.6rem; border-top: 1px solid #efefef; }
  .ad-label {
    position: absolute;
    top: -0.9rem;
    left: 0.5rem;
    font-size: 1.1rem;
    color: #888;
    background: var(--color-background,#fafafa);
    border: 1px solid #e5e5e5;
    padding: 2px 6px;
    line-height: 1.2;
  }
  .ad-container { display: block; text-align: center; }
  .ad-item {
    display: block;
    border: 1px solid #e5e5e5;
    background: #fff;
    transition: transform 0.2s ease;
    max-width: 90%;
    margin: 0 auto;
  }
  .ad-item:hover { transform: translateY(-2px); }
  .ad-item:focus-visible { outline: 2px dotted #bbb; outline-offset: 2px; }
  .ad-item img { width: 100%; height: auto; display: block; }
  @media (min-width: 768px) {
    .ad-item { max-width: 720px; }
  }
</style>