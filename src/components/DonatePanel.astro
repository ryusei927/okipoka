---
// Props (将来的に外部化可能)
const presetAmounts: number[] = [300, 1000, 1500, 2000, 3000, 5000, 10000];
// Squareペイメントリンクのマッピング（暫定placeholders）
// 実際には管理画面で生成したURLに差し替え
const paymentLinks: Record<number,string> = {
  300: 'https://example.com/square/300',
  1000: 'https://example.com/square/1000',
  1500: 'https://example.com/square/1500',
  2000: 'https://example.com/square/2000',
  3000: 'https://example.com/square/3000',
  5000: 'https://example.com/square/5000',
  10000: 'https://example.com/square/10000'
};
---
<div class="donate-wrapper">
  <div class="donate-header">
    <h1>サイト継続のご支援をお願いします</h1>
    <p class="lead">OKIPOKAは沖縄のポーカー情報を無料で整理・更新しています。サーバー費・取材/検証工数の一部を寄付でサポートしていただけると、更新頻度と精度をさらに高められます。</p>
  </div>
  <div class="donate-mode-toggle" role="tablist" aria-label="寄付種別">
    <button class="mode-btn active" data-mode="once" aria-selected="true">今回のみ</button>
    <button class="mode-btn" data-mode="monthly" aria-selected="false">毎月の継続寄付 (β)</button>
  </div>
  <div class="amount-grid" aria-label="金額を選択">
    {presetAmounts.map(a => (
      <button class="amount-btn" data-amount={a}>¥{a.toLocaleString()}</button>
    ))}
  </div>
  <div class="donate-action">
    <button id="donateSubmit" class="donate-submit" disabled>寄付手続きへ進む</button>
    <p class="note">※ 決済画面へ移動します。現時点ではテストリンクです。</p>
  </div>
  <section class="transparency">
    <h2>寄付の使途</h2>
    <ul>
      <li>トーナメント情報の自動取得スクリプト保守</li>
      <li>新規店舗・イベントの確認作業</li>
      <li>戦略・ルール記事の執筆/校正</li>
    </ul>
  </section>
</div>
<!-- Squareリンク埋め込み用 (後でサーバー側生成に差し替え可) -->
<script id="paymentLinksData" type="application/json">{ "300": "https://example.com/square/300", "1000": "https://example.com/square/1000", "1500": "https://example.com/square/1500", "2000": "https://example.com/square/2000", "3000": "https://example.com/square/3000", "5000": "https://example.com/square/5000", "10000": "https://example.com/square/10000" }</script>
<script>
  // 型安全な取得
  const presetButtons = Array.from(document.querySelectorAll<HTMLButtonElement>('.amount-btn'));
  const submitBtn = document.getElementById('donateSubmit') as HTMLButtonElement | null;
  const modeButtons = Array.from(document.querySelectorAll<HTMLButtonElement>('.mode-btn'));
  let selectedAmount: number | null = null; let mode: 'once' | 'monthly' = 'once';
  function updateState() { if (submitBtn) submitBtn.disabled = !selectedAmount; }
  presetButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      presetButtons.forEach(b=>b.classList.remove('selected'));
      btn.classList.add('selected');
      selectedAmount = parseInt(btn.dataset.amount || '0');
      updateState();
    });
  });
  modeButtons.forEach(mb => {
    mb.addEventListener('click', () => {
      modeButtons.forEach(b=>b.classList.remove('active')); mb.classList.add('active'); mode = (mb.dataset.mode === 'monthly') ? 'monthly' : 'once';
      // 継続寄付モードのUI拡張は後工程
    });
  });
  if (submitBtn) {
    submitBtn.addEventListener('click', () => {
      if (!selectedAmount) return;
      console.log('donate_button_click', { amount: selectedAmount, mode });
      // Squareペイメントリンク遷移（暫定）
      // paymentLinks は上部Astro変数をHTML展開時に埋め込む
      const links = JSON.parse(document.getElementById('paymentLinksData')?.textContent || '{}');
      const url = links[String(selectedAmount)] || links['1000'] || 'https://example.com/square/placeholder';
      window.location.href = url;
    });
  }
</script>
<style>
  .donate-wrapper { max-width: 860px; margin: 2rem auto; background: var(--color-surface); padding: 2rem 2.2rem; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
  .donate-header h1 { font-size: 1.9rem; margin-bottom: .75rem; }
  .donate-header .lead { color: var(--color-text-muted); font-size: .95rem; line-height: 1.6; }
  .donate-mode-toggle { display: flex; gap: .75rem; margin: 1.2rem 0 1.4rem; }
  .mode-btn { flex:1; padding:.9rem 1rem; font-weight:600; background:#f1f3f5; border:1px solid #ced4da; border-radius:8px; cursor:pointer; transition:.2s; }
  .mode-btn.active { background: var(--color-primary); color:#fff; border-color: var(--color-primary); }
  .amount-grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(110px,1fr)); gap:.75rem; }
  .amount-btn { padding:.85rem .6rem; background:#fff; border:1px solid #ced4da; border-radius:10px; font-weight:600; cursor:pointer; transition:.2s; }
  .amount-btn.selected, .amount-btn:hover { background: var(--color-primary); color:#fff; border-color: var(--color-primary); }
  .donate-action { margin-top:1.6rem; text-align:center; }
  .donate-submit { padding:1rem 2.2rem; font-size:1.05rem; font-weight:700; background: var(--color-primary); color:#fff; border:none; border-radius:10px; cursor:pointer; transition:.2s; }
  .donate-submit:disabled { opacity:.4; cursor:not-allowed; }
  .donate-submit:not(:disabled):hover { background:#e67300; }
  .note { font-size:.75rem; color: var(--color-text-muted); margin-top:.6rem; }
  .transparency { margin-top:2.5rem; }
  .transparency h2 { font-size:1.3rem; margin-bottom:.6rem; }
  .transparency ul { list-style:disc; padding-left:1.4rem; margin-bottom:1rem; }
  .goal { font-size:.85rem; color: var(--color-text-muted); }
  @media (max-width:600px){ .donate-wrapper { padding:1.4rem 1.2rem; } }
</style>
