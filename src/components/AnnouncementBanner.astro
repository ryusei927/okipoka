---
// お知らせの設定 - ここでお知らせのON/OFFと内容を管理
const announcements = [
  {
    id: 'j9-championship-countdown',
    type: 'countdown',
    active: true, // このお知らせを表示するかどうか
    title: '� J9 CHAMPIONSHIP',
    subtitle: 'ついに開催！沖縄最高峰のポーカートーナメント',
    targetDate: '2025-10-12T12:00:00+09:00', // 10/12(日) 12:00開始
    description: '熱戦が今週末に迫る！参加者募集中',
    buttonText: '詳細・エントリー',
    buttonUrl: 'https://www.okipoka.com/tournaments/2H4HTy5InU4kJ8KeyZeW',
    backgroundImage: '/images/osirase/j9championship.jpg',
    bgColor: 'rgba(0, 0, 0, 0.6)', // 画像の上にオーバーレイ
    textColor: '#ffffff'
  },
  // 他のお知らせもここに追加可能
  // {
  //   id: 'job-recruitment',
  //   type: 'general',
  //   active: false,
  //   title: '🚀 スタッフ募集中',
  //   subtitle: 'アミューズメント施設で一緒に働きませんか？',
  //   description: '未経験歓迎！ポーカー好き大歓迎！',
  //   buttonText: '求人詳細',
  //   buttonUrl: '/jobs/staff-2025',
  //   bgColor: 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)',
  //   textColor: '#ffffff'
  // }
];

// アクティブなお知らせのみを抽出
const activeAnnouncements = announcements.filter(announcement => announcement.active);
---

{activeAnnouncements.length > 0 && (
  <section class="announcements-wrapper">
    {activeAnnouncements.map((announcement) => (
      <a 
        href={announcement.buttonUrl || '#'}
        class={`announcement-banner ${announcement.type} ${announcement.backgroundImage ? 'with-image' : ''}`}
        style={`
          ${announcement.backgroundImage ? 
            `background: url('${announcement.backgroundImage}'); background-size: cover; background-position: center;` : 
            `background: ${announcement.bgColor};`
          } 
          color: ${announcement.textColor};
        `}
      >
        {announcement.backgroundImage && (
          <div class="image-overlay"></div>
        )}
        <div class="announcement-content">
          {announcement.type === 'countdown' && (
            <div class="countdown-badge" data-target={announcement.targetDate}>
              <span class="countdown-text">
                <span class="countdown-label">開催まで</span>
                <span class="days">--</span>
                <span class="day-label">日</span>
              </span>
            </div>
          )}
        </div>
      </a>
    ))}
  </section>
)}

<style>
  .announcements-wrapper {
    max-width: 900px;
    margin: 2rem auto;
    padding: 0 1rem;
  }

  .announcement-banner {
    border-radius: 16px;
    padding: 0;
    margin-bottom: 1.5rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
    position: relative;
    overflow: hidden;
    width: 400px;
    height: 400px;
    margin-left: auto;
    margin-right: auto;
    display: block;
    text-decoration: none;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .announcement-banner:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.18);
  }

  /* 画像オーバーレイ - 画像を隠さずにテキストを読みやすくする */
  .image-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
      135deg,
      rgba(0, 0, 0, 0.4) 0%,
      rgba(0, 0, 0, 0.2) 30%,
      rgba(0, 0, 0, 0.1) 60%,
      rgba(0, 0, 0, 0.3) 100%
    );
    pointer-events: none;
  }

  /* 画像がない場合の軽いオーバーレイ */
  .announcement-banner:not(.with-image)::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    pointer-events: none;
  }

  .announcement-content {
    position: relative;
    z-index: 2;
    width: 100%;
    height: 100%;
  }

  .countdown-badge {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    background: rgba(0, 0, 0, 0.8);
    color: #ffffff;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 700;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    z-index: 3;
  }

  .countdown-text {
    display: flex;
    align-items: center;
    gap: 0.2rem;
  }

  .countdown-text .days {
    font-size: 1.1rem;
    font-weight: 900;
    color: #ff6b35;
  }

  .countdown-label,
  .day-label {
    font-size: 0.9rem;
    font-weight: 600;
    color: #ffffff;
  }

  /* レスポンシブ対応 */
  @media (max-width: 768px) {
    .announcements-wrapper {
      margin: 1rem auto;
      padding: 0 0.75rem;
    }

    .announcement-banner {
      width: 320px;
      height: 320px;
      margin-bottom: 1rem;
    }

    .countdown-badge {
      bottom: 0.8rem;
      right: 0.8rem;
      font-size: 0.8rem;
      padding: 0.4rem 0.8rem;
    }
  }

  @media (max-width: 480px) {
    .announcement-banner {
      width: 280px;
      height: 280px;
    }

    .countdown-badge {
      bottom: 0.6rem;
      right: 0.6rem;
      font-size: 0.75rem;
      padding: 0.3rem 0.6rem;
    }

    .countdown-text .days {
      font-size: 1rem;
    }
  }
</style>

<script is:inline>
  // カウントダウンと本日開催表示の実装
  function initCountdownBadges() {
    const countdownElements = document.querySelectorAll('.countdown-badge[data-target]');
    
    countdownElements.forEach(element => {
      const targetDate = new Date(element.dataset.target);
      const today = new Date();
      
      // 日付のみで比較するため時刻をリセット
      const targetDateOnly = new Date(targetDate.getFullYear(), targetDate.getMonth(), targetDate.getDate());
      const todayOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate());
      
      function updateCountdown() {
        const timeDiff = targetDateOnly.getTime() - todayOnly.getTime();
        const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
        
        const countdownLabel = element.querySelector('.countdown-label');
        const daysElement = element.querySelector('.days');
        const dayLabel = element.querySelector('.day-label');
        
        if (daysDiff < 0) {
          // 過ぎた場合
          countdownLabel.textContent = '終了';
          daysElement.textContent = '';
          dayLabel.textContent = '';
        } else if (daysDiff === 0) {
          // 当日の場合
          countdownLabel.textContent = '本日';
          daysElement.textContent = '開催';
          dayLabel.textContent = '';
          daysElement.style.color = '#00ff00'; // 緑色で強調
        } else {
          // カウントダウン中
          countdownLabel.textContent = '開催まで';
          daysElement.textContent = daysDiff.toString();
          dayLabel.textContent = '日';
          daysElement.style.color = '#ff6b35'; // 元の色
        }
      }
      
      // 初回実行
      updateCountdown();
      
      // 1時間ごとに更新（当日判定のため）
      setInterval(updateCountdown, 1000 * 60 * 60);
    });
  }
  
  // DOMContentLoadedまたはページロード時に実行
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCountdownBadges);
  } else {
    initCountdownBadges();
  }
</script>