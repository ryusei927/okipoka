---
/**
 * ページ: 本日のトーナメント情報 (/tournaments/tournaments)
 * 役割: その日の開催トーナメントを店舗ごとに一覧表示するページ。
 * 読み込み: ヘッダー/フッター、広告、CSS、JS（/js/tournaments.js がリストを生成）
 * メモ:
 *  - 広告は adList.json からランダムに2つ選んで表示（上部/下部）
 *  - 画面上の「表示日」(input type="date") で日付を切り替え
 *  - ページ内の文言や見た目を微調整したい場合は CSS ファイルを編集（インラインstyleは将来CSSに移行予定）
 */
import Analytics from '@vercel/analytics/astro';
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import InterstitialAd from "../../components/InterstitialAd.astro";

// 広告一覧を読み込み（standard1〜5 を一つの配列に結合）
import adList from "../../assets/adList.json";
const standard = adList.standard1.concat(
    adList.standard2,
    adList.standard3,
    adList.standard4,
    adList.standard5,
);
// ランダムに2つ選ぶ（上バナーと下バナー）
const randomAd = standard[Math.floor(Math.random() * standard.length)];
const randomAd2 = standard[Math.floor(Math.random() * standard.length)];

// ページ専用/共通のスタイル
import "../../styles/header_footer.css";
import "../../styles/tournaments.css";
---

<!doctype html>
<html lang="ja">
  <head>
    <!-- 文字コード指定（日本語表示の基本設定） -->
    <meta charset="UTF-8" />
    <!-- スマホ対応（ビューポート設定） -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- 検索/SNSプレビュー用の説明文 -->
    <meta name="description" content="沖縄でポーカーができるアミューズメント店舗やトーナメント情報を毎日更新。初心者や旅行者にも安心のポータルサイトOKIPOKA。" />

    <title>本日のトーナメント情報 | OKIPOKA</title>
    <!-- タブ/ブックマーク用のサイトアイコン -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
  </head>

  <body>
    <!-- サイト共通のヘッダー（ロゴ/ナビ） -->
    <Header />
    <!-- 画面遷移時などに表示する差し込み広告（必要に応じてON/OFF） -->
    <InterstitialAd />

    <main>
      <!-- ==================== 上部ランダム広告 ==================== -->
      <!-- 画像とリンクは adList.json の standard 配列からランダム選択 -->
      <div class="standard-ad-wrapper" style="text-align: center; margin: 1.5rem 0;">
        <a href={randomAd.link} target="_blank" rel="noopener noreferrer">
          <img src={randomAd.image} alt="スポンサー広告" style="max-width: 650px; width: 100%; height: auto;" />
        </a>
      </div>

      <!-- ==================== トーナメント情報本体 ==================== -->
      <section class="tournament-info">
        <h2>トーナメント情報</h2>

        <!-- 日付切り替えUI（input type=date）。handlersは /js/tournaments.js 側で実装想定 -->
        <div style="text-align: center; margin: 1rem auto 1.5rem; padding: 0.8rem 1rem; background-color: #f8f8f8; border-radius: 8px; max-width: 320px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);">
          <label for="datePicker" style="font-weight: bold; margin-right: 0.5em; font-size: 1rem;">表示日：</label>
          <input type="date" id="datePicker" style="padding: 0.4em; font-size: 0.95rem; border-radius: 4px; border: 1px solid #ccc;" />
        </div>

        <!-- 今日の日付（JST）を表示する場所。DOMContentLoaded 後にJSで書き込み -->
        <p id="today-date" style="text-align: center; color: #666; font-size: 0.9rem;"></p>

        <!-- ページの説明文（運用上の注意） -->
        <p>
          沖縄県内で開催予定のトーナメント情報を店舗別に掲載しています。掲載内容は各店舗からの提供情報をもとにしており、詳細については店舗によって異なる場合があります。ご不明な点や気になる点がありましたら、各店舗までお気軽にお問い合わせください。
        </p>

        <!-- JS がここにカード（店舗ごとの開催リスト）を差し込みます -->
        <div id="tournament-list"></div>
      </section>

      <!-- ==================== 下部ランダム広告 ==================== -->
      <div class="standard-ad-wrapper" style="text-align: center; margin: 1.5rem 0;">
        <a href={randomAd2.link} target="_blank" rel="noopener noreferrer">
          <img src={randomAd2.image} alt="スポンサー広告" style="max-width: 650px; width: 100%; height: auto;" />
        </a>
      </div>
    </main>

    <!-- サイト共通のフッター（コピーライト/補助リンク） -->
    <Footer />
    <!-- アクセス解析（PV/滞在時間など） -->
    <Analytics />

    <!-- ページ専用JS。リスト描画やヘッダー動作、日付の初期表示などを担当 -->
    <script src="/js/tournaments.js" type="module"></script>
    <script src="/js/header.js" type="module"></script>

    <!-- 今日の日付（JST）を「本日：YYYY-MM-DD」形式で表示する軽いスクリプト -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // 現在の日時を取得
        const now = new Date();
        // タイムゾーン差（分）を取得（例: JSTは -540 分）
        const offset = now.getTimezoneOffset();
        // UTCをJST相当に補正（マイナス方向にずらす）
        const jstDate = new Date(now.getTime() - offset * 60 * 1000);
        // YYYY-MM-DD の形に整形
        const formatted = jstDate.toISOString().slice(0, 10);
        // 表示場所に書き込む
        // @ts-ignore: #today-date は存在する前提（上で用意済み）
        document.getElementById("today-date").textContent = `本日：${formatted}`;
      });
    </script>
  </body>
</html>
